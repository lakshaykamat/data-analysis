# CASE WHEN

# SQL Notes: CASE WHEN Statement

## Introduction

The `CASE` statement in SQL is used for conditional expressions. It allows you to perform conditional logic in your queries, similar to `if-else` statements in programming languages.

### Syntax

```sql
CASE
    WHEN condition1 THEN result1
    WHEN condition2 THEN result2
    ...
    [ELSE resultN]
END
```

### Key Points

- **`WHEN`** specifies the condition.
- **`THEN`** specifies the result if the condition is true.
- **`ELSE`** specifies the result if none of the conditions are true (optional).
- **`END`** marks the end of the `CASE` statement.
- Can be used in:
    - `SELECT`
    - `UPDATE`
    - `INSERT`
    - `WHERE`
    - `ORDER BY` clauses.

---

## Examples

### 1. Basic Usage in SELECT

Return the category of a product based on its price.

```sql
SELECT
    product_name,
    price,
    CASE
        WHEN price < 10 THEN 'Cheap'
        WHEN price BETWEEN 10 AND 50 THEN 'Affordable'
        ELSE 'Expensive'
    END AS price_category
FROM products;

```

**Explanation**:

- Products with `price < 10` are labeled as `'Cheap'`.
- Products with `price BETWEEN 10 AND 50` are labeled as `'Affordable'`.
- Products with `price > 50` are labeled as `'Expensive'`.

---

### 2. Using CASE in WHERE Clause

Filter rows based on conditional logic.

```sql
SELECT *
FROM orders
WHERE
    CASE
        WHEN order_status = 'Pending' THEN delivery_date > CURRENT_DATE
        WHEN order_status = 'Completed' THEN delivery_date IS NOT NULL
        ELSE TRUE
    END;

```

**Explanation**:

- Filters orders where:
    - If the status is `'Pending'`, the `delivery_date` must be in the future.
    - If the status is `'Completed'`, the `delivery_date` must not be `NULL`.
    - For all other cases, all rows are included.

---

### 3. Using CASE in ORDER BY

Sort data based on a calculated column.

```sql
SELECT
    customer_name,
    total_purchase,
    CASE
        WHEN total_purchase < 100 THEN 'Low'
        WHEN total_purchase BETWEEN 100 AND 500 THEN 'Medium'
        ELSE 'High'
    END AS customer_tier
FROM customers
ORDER BY
    CASE
        WHEN total_purchase < 100 THEN 1
        WHEN total_purchase BETWEEN 100 AND 500 THEN 2
        ELSE 3
    END;

```

**Explanation**:

- Customers are categorized into tiers: `'Low'`, `'Medium'`, `'High'`.
- Sorting is done by numerical representation of tiers (1, 2, 3).

---

### 4. Using CASE in UPDATE

Update rows conditionally.

```sql
UPDATE employees
SET salary_bonus =
    CASE
        WHEN performance_rating = 'Excellent' THEN salary * 0.20
        WHEN performance_rating = 'Good' THEN salary * 0.10
        ELSE salary * 0.05
    END;

```

**Explanation**:

- Employees with `'Excellent'` performance receive a 20% bonus.
- Employees with `'Good'` performance receive a 10% bonus.
- Others receive a 5% bonus.

---

### 5. Using Nested CASE

Handle complex conditions with nested `CASE`.

```sql
SELECT
    employee_name,
    CASE
        WHEN department = 'Sales' THEN
            CASE
                WHEN performance_rating = 'Excellent' THEN 'Top Performer'
                ELSE 'Average Performer'
            END
        WHEN department = 'HR' THEN 'HR Staff'
        ELSE 'Other Staff'
    END AS performance_category
FROM employees;

```

**Explanation**:

- Nested conditions for the `'Sales'` department.
- Employees in `'HR'` and other departments are categorized separately.

---

## Common Use Cases

1. Data transformation and categorization.
2. Conditional updates or inserts.
3. Custom sorting.
4. Filtering rows based on complex logic.

## Tips

- Always use a default `ELSE` clause to handle unexpected cases unless the logic ensures all conditions are covered.
- Ensure conditions in `WHEN` do not overlap to avoid ambiguity.
- Avoid over-complicating `CASE` statements for better readability and maintainability.

---